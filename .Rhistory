add_row (date = "2020-11-08", 11, 11, 11)
add_row (date = "2020-11-08", canton_cases = 11, plymouthcity_cases = 11, plymouthtownship_cases = 11)
tibble (date = "2020-11-08", canton_cases = 11, plymouthcity_cases = 11, plymouthtownship_cases = 11)
rbind (dat_from_file, tibble (date = "2020-11-08", canton_cases = 11, plymouthcity_cases = 11, plymouthtownship_cases = 11)
)
runApp()
?reactive
runApp()
runApp()
runApp()
runApp()
runApp()
?date
runApp()
runApp()
latest_date = Sys.Date()
earliest_date = latest_date - 20
seq (eearliest_date, latest_date)
seq (earliest_date, latest_date)
seq (earliest_date, latest_date, by = 1)
runApp()
c(seq (earliest_date, latest_date, by = 1))
cat(seq (earliest_date, latest_date, by = 1))
cat(as.Date(seq (earliest_date, latest_date, by = 1)))
(seq (earliest_date, latest_date, by = 1)))
(seq (earliest_date, latest_date, by = 1))
str((seq (earliest_date, latest_date, by = 1)))
cat (as.Date.character(seq (earliest_date, latest_date, by = 1))
)
cat (date(seq (earliest_date, latest_date, by = 1))
)
(seq (earliest_date, latest_date, by = "days"))
runApp()
?dateInput
as.character(seq (earliest_date, latest_date, by = "days"))
runApp()
runApp()
runApp()
View(dat_from_file)
runApp()
runApp()
runApp()
runApp()
?str_replace
runApp()
runApp()
?flushReact
library (shiny)
?flushReact
?req
runApp()
runApp()
runApp()
?reactiveValues
runApp()
runApp()
recalculate_incidences <- function (dat) {
dat = dat %>%
mutate (date = as.Date(date, format = c("%m/%d")),
combined_cases = canton_cases+ plymouthcity_cases + plymouthtownship_cases,
canton_incidence = (canton_cases/as.numeric(denoms[1,2]) * 1000000),
plymouthcity_incidence = (plymouthcity_cases/as.numeric(denoms[2,2]) * 1000000),
plymouthtownship_incidence = (plymouthtownship_cases/as.numeric(denoms[3,2]) * 1000000),
combined_incidence = (combined_cases/as.numeric(denoms[4,2]) * 1000000),
canton_7day = c(rep(NA, 6),rollmean (canton_incidence, k = 7, align = "right")),
plymouthcity_7day =c(rep(NA, 6), rollmean (plymouthcity_incidence, k = 7, align = "right")),
plymouthtownship_7day = c(rep(NA, 6),rollmean (plymouthtownship_incidence, k = 7, align = "right")),
combined_7day = c(rep(NA, 6),rollmean (combined_incidence, k = 7, align = "right")),
canton_15day = c(rep(NA, 14),rollmean (canton_incidence, k = 15, align = "right")),
plymouthcity_15day =c(rep(NA, 14), rollmean (plymouthcity_incidence, k = 15, align = "right")),
plymouthtownship_15day = c(rep(NA, 14),rollmean (plymouthtownship_incidence, k = 15, align = "right")),
combined_15day = c(rep(NA, 14),rollmean (combined_incidence, k = 15, align = "right")),
canton_28day = c(rep(NA, 27),rollmean (canton_incidence, k = 28, align = "right")),
plymouthcity_28day =c(rep(NA, 27), rollmean (plymouthcity_incidence, k = 28, align = "right")),
plymouthtownship_28day = c(rep(NA, 27),rollmean (plymouthtownship_incidence, k = 28, align = "right")),
combined_28day = c(rep(NA, 27),rollmean (combined_incidence, k = 28, align = "right")),
) %>%
pivot_longer(cols = -date,
names_to = c("municipality","measure"),
names_sep = "_",
values_to = "value") %>%
mutate (municipality = case_when (
municipality ==  "canton" ~ "Canton",
municipality =="plymouthcity" ~ "Plymouth City",
municipality =="plymouthtownship" ~ "Plymouth Township",
municipality =="combined" ~ "Combined (Canton and Plymouth)")) %>%
mutate (municipality = factor (municipality, levels = c ("Canton", "Plymouth City", "Plymouth Township", "Combined (Canton and Plymouth)")),
value = round (value, 1))
dat$color = as.character (recode (dat$municipality,
'Canton' = "#E90003",
'Plymouth City' = "#1B9E77",
'Plymouth Township' = "#7570B3",
'Combined (Canton and Plymouth)' = "#AAAAAA"))
dat$linetype = as.character (recode (dat$municipality,
'Canton' = 'dash',
'Plymouth City' = 'dot',
'Plymouth Township' = 'dotdash',
'Combined (Canton and Plymouth)' = 'solid'))
return (dat)
}
denoms = readr::read_csv ("denominators.csv",
col_names = c("municipality", "population"),
col_types = "cd")
dat_cases_only = readr::read_csv("covid_cases_20201108.csv",
col_names = c("date",
"canton_cases",
"plymouthcity_cases",
"plymouthtownship_cases"),
col_types = "cddd",
skip=1,
na = ".",
skip_empty_rows = T)
dat_all = recalculate_incidences (dat_cases_only)
max (dat_all)
max (dat_all$date)
str(dat_all)
unique(dat_all$measure)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
recalculate_incidences <- function (dat) {
dat = dat %>%
mutate (date = as.Date(date, format = c("%m/%d")),
combined_cases = canton_cases+ plymouthcity_cases + plymouthtownship_cases,
canton_incidence = (canton_cases/as.numeric(denoms[1,2]) * 1000000),
plymouthcity_incidence = (plymouthcity_cases/as.numeric(denoms[2,2]) * 1000000),
plymouthtownship_incidence = (plymouthtownship_cases/as.numeric(denoms[3,2]) * 1000000),
combined_incidence = (combined_cases/as.numeric(denoms[4,2]) * 1000000),
canton_7day = c(rep(NA, 6),rollmean (canton_incidence, k = 7, align = "right")),
plymouthcity_7day =c(rep(NA, 6), rollmean (plymouthcity_incidence, k = 7, align = "right")),
plymouthtownship_7day = c(rep(NA, 6),rollmean (plymouthtownship_incidence, k = 7, align = "right")),
combined_7day = c(rep(NA, 6),rollmean (combined_incidence, k = 7, align = "right")),
canton_15day = c(rep(NA, 14),rollmean (canton_incidence, k = 15, align = "right")),
plymouthcity_15day =c(rep(NA, 14), rollmean (plymouthcity_incidence, k = 15, align = "right")),
plymouthtownship_15day = c(rep(NA, 14),rollmean (plymouthtownship_incidence, k = 15, align = "right")),
combined_15day = c(rep(NA, 14),rollmean (combined_incidence, k = 15, align = "right")),
canton_28day = c(rep(NA, 27),rollmean (canton_incidence, k = 28, align = "right")),
plymouthcity_28day =c(rep(NA, 27), rollmean (plymouthcity_incidence, k = 28, align = "right")),
plymouthtownship_28day = c(rep(NA, 27),rollmean (plymouthtownship_incidence, k = 28, align = "right")),
combined_28day = c(rep(NA, 27),rollmean (combined_incidence, k = 28, align = "right")),
) %>%
pivot_longer(cols = -date,
names_to = c("municipality","measure"),
names_sep = "_",
values_to = "value") %>%
mutate (municipality = case_when (
municipality ==  "canton" ~ "Canton",
municipality =="plymouthcity" ~ "Plymouth City",
municipality =="plymouthtownship" ~ "Plymouth Township",
municipality =="combined" ~ "Combined (Canton and Plymouth)")) %>%
mutate (municipality = factor (municipality, levels = c ("Canton", "Plymouth City", "Plymouth Township", "Combined (Canton and Plymouth)")),
value = round (value, 1))
dat$color = as.character (recode (dat$municipality,
'Canton' = "#E90003",
'Plymouth City' = "#1B9E77",
'Plymouth Township' = "#7570B3",
'Combined (Canton and Plymouth)' = "#AAAAAA"))
dat$linetype = as.character (recode (dat$municipality,
'Canton' = 'dash',
'Plymouth City' = 'dot',
'Plymouth Township' = 'dotdash',
'Combined (Canton and Plymouth)' = 'solid'))
return (dat)
}
denoms = readr::read_csv ("denominators.csv",
col_names = c("municipality", "population"),
col_types = "cd")
dat_cases_only = readr::read_csv("covid_cases_20201108.csv",
col_names = c("date",
"canton_cases",
"plymouthcity_cases",
"plymouthtownship_cases"),
col_types = "cddd",
skip=1,
na = ".",
skip_empty_rows = T)
dat_cases_only
dat_all = recalculate_incidences (dat_cases_only)
dat_all
recalculate_incidences <- function (dat) {
dat = dat %>%
mutate (date = as.Date(date, format = c("%d-%M")),
combined_cases = canton_cases+ plymouthcity_cases + plymouthtownship_cases,
canton_incidence = (canton_cases/as.numeric(denoms[1,2]) * 1000000),
plymouthcity_incidence = (plymouthcity_cases/as.numeric(denoms[2,2]) * 1000000),
plymouthtownship_incidence = (plymouthtownship_cases/as.numeric(denoms[3,2]) * 1000000),
combined_incidence = (combined_cases/as.numeric(denoms[4,2]) * 1000000),
canton_7day = c(rep(NA, 6),rollmean (canton_incidence, k = 7, align = "right")),
plymouthcity_7day =c(rep(NA, 6), rollmean (plymouthcity_incidence, k = 7, align = "right")),
plymouthtownship_7day = c(rep(NA, 6),rollmean (plymouthtownship_incidence, k = 7, align = "right")),
combined_7day = c(rep(NA, 6),rollmean (combined_incidence, k = 7, align = "right")),
canton_15day = c(rep(NA, 14),rollmean (canton_incidence, k = 15, align = "right")),
plymouthcity_15day =c(rep(NA, 14), rollmean (plymouthcity_incidence, k = 15, align = "right")),
plymouthtownship_15day = c(rep(NA, 14),rollmean (plymouthtownship_incidence, k = 15, align = "right")),
combined_15day = c(rep(NA, 14),rollmean (combined_incidence, k = 15, align = "right")),
canton_28day = c(rep(NA, 27),rollmean (canton_incidence, k = 28, align = "right")),
plymouthcity_28day =c(rep(NA, 27), rollmean (plymouthcity_incidence, k = 28, align = "right")),
plymouthtownship_28day = c(rep(NA, 27),rollmean (plymouthtownship_incidence, k = 28, align = "right")),
combined_28day = c(rep(NA, 27),rollmean (combined_incidence, k = 28, align = "right")),
) %>%
pivot_longer(cols = -date,
names_to = c("municipality","measure"),
names_sep = "_",
values_to = "value") %>%
mutate (municipality = case_when (
municipality ==  "canton" ~ "Canton",
municipality =="plymouthcity" ~ "Plymouth City",
municipality =="plymouthtownship" ~ "Plymouth Township",
municipality =="combined" ~ "Combined (Canton and Plymouth)")) %>%
mutate (municipality = factor (municipality, levels = c ("Canton", "Plymouth City", "Plymouth Township", "Combined (Canton and Plymouth)")),
value = round (value, 1))
dat$color = as.character (recode (dat$municipality,
'Canton' = "#E90003",
'Plymouth City' = "#1B9E77",
'Plymouth Township' = "#7570B3",
'Combined (Canton and Plymouth)' = "#AAAAAA"))
dat$linetype = as.character (recode (dat$municipality,
'Canton' = 'dash',
'Plymouth City' = 'dot',
'Plymouth Township' = 'dotdash',
'Combined (Canton and Plymouth)' = 'solid'))
return (dat)
}
dat_all = recalculate_incidences (dat_cases_only)
dat_all
View(dat_all)
dat_cases_only = readr::read_csv("covid_cases_20201108.csv",
col_names = c("date",
"canton_cases",
"plymouthcity_cases",
"plymouthtownship_cases"),
col_types = "cddd",
skip=1,
na = ".",
skip_empty_rows = T)
dat_cases_only
View(dat_cases_only)
recalculate_incidences <- function (dat) {
dat = dat %>%
mutate (date = as.Date(date, format = c("%d-%b")),
combined_cases = canton_cases+ plymouthcity_cases + plymouthtownship_cases,
canton_incidence = (canton_cases/as.numeric(denoms[1,2]) * 1000000),
plymouthcity_incidence = (plymouthcity_cases/as.numeric(denoms[2,2]) * 1000000),
plymouthtownship_incidence = (plymouthtownship_cases/as.numeric(denoms[3,2]) * 1000000),
combined_incidence = (combined_cases/as.numeric(denoms[4,2]) * 1000000),
canton_7day = c(rep(NA, 6),rollmean (canton_incidence, k = 7, align = "right")),
plymouthcity_7day =c(rep(NA, 6), rollmean (plymouthcity_incidence, k = 7, align = "right")),
plymouthtownship_7day = c(rep(NA, 6),rollmean (plymouthtownship_incidence, k = 7, align = "right")),
combined_7day = c(rep(NA, 6),rollmean (combined_incidence, k = 7, align = "right")),
canton_15day = c(rep(NA, 14),rollmean (canton_incidence, k = 15, align = "right")),
plymouthcity_15day =c(rep(NA, 14), rollmean (plymouthcity_incidence, k = 15, align = "right")),
plymouthtownship_15day = c(rep(NA, 14),rollmean (plymouthtownship_incidence, k = 15, align = "right")),
combined_15day = c(rep(NA, 14),rollmean (combined_incidence, k = 15, align = "right")),
canton_28day = c(rep(NA, 27),rollmean (canton_incidence, k = 28, align = "right")),
plymouthcity_28day =c(rep(NA, 27), rollmean (plymouthcity_incidence, k = 28, align = "right")),
plymouthtownship_28day = c(rep(NA, 27),rollmean (plymouthtownship_incidence, k = 28, align = "right")),
combined_28day = c(rep(NA, 27),rollmean (combined_incidence, k = 28, align = "right")),
) %>%
pivot_longer(cols = -date,
names_to = c("municipality","measure"),
names_sep = "_",
values_to = "value") %>%
mutate (municipality = case_when (
municipality ==  "canton" ~ "Canton",
municipality =="plymouthcity" ~ "Plymouth City",
municipality =="plymouthtownship" ~ "Plymouth Township",
municipality =="combined" ~ "Combined (Canton and Plymouth)")) %>%
mutate (municipality = factor (municipality, levels = c ("Canton", "Plymouth City", "Plymouth Township", "Combined (Canton and Plymouth)")),
value = round (value, 1))
dat$color = as.character (recode (dat$municipality,
'Canton' = "#E90003",
'Plymouth City' = "#1B9E77",
'Plymouth Township' = "#7570B3",
'Combined (Canton and Plymouth)' = "#AAAAAA"))
dat$linetype = as.character (recode (dat$municipality,
'Canton' = 'dash',
'Plymouth City' = 'dot',
'Plymouth Township' = 'dotdash',
'Combined (Canton and Plymouth)' = 'solid'))
return (dat)
}
denoms = readr::read_csv ("denominators.csv",
col_names = c("municipality", "population"),
col_types = "cd")
dat_cases_only = readr::read_csv("covid_cases_20201108.csv",
col_names = c("date",
"canton_cases",
"plymouthcity_cases",
"plymouthtownship_cases"),
col_types = "cddd",
skip=1,
na = ".",
skip_empty_rows = T)
dat_all = recalculate_incidences (dat_cases_only)
dat_all
runApp()
dat_selected
dat_all
min (dat_all$date)
View(dat_all)
dat_cases_only = readr::read_csv("covid_cases_20201108.csv",
col_names = c("date",
"canton_cases",
"plymouthcity_cases",
"plymouthtownship_cases"),
col_types = "cddd",
skip=1,
na = ".",
skip_empty_rows = T)
dat_cases_only
View(dat_cases_only)
dat_cases_only = readr::read_csv("covid_cases_20201108.csv",
col_names = c("date",
"canton_cases",
"plymouthcity_cases",
"plymouthtownship_cases"),
col_types = "cddd",
skip=1,
na = ".",
skip_empty_rows = T)
runApp()
runApp()
runApp()
runApp()
?as.Date
runApp()
runApp()
recalculate_incidences <- function (dat) {
dat = dat %>%
mutate (date = as.Date(date, format = c("%Y-%m-%d"),
tryFormats = c("%d-%b")),
combined_cases = canton_cases+ plymouthcity_cases + plymouthtownship_cases,
canton_incidence = (canton_cases/as.numeric(denoms[1,2]) * 1000000),
plymouthcity_incidence = (plymouthcity_cases/as.numeric(denoms[2,2]) * 1000000),
plymouthtownship_incidence = (plymouthtownship_cases/as.numeric(denoms[3,2]) * 1000000),
combined_incidence = (combined_cases/as.numeric(denoms[4,2]) * 1000000),
canton_7day = c(rep(NA, 6),zoo::rollmean (canton_incidence, k = 7, align = "right")),
plymouthcity_7day =c(rep(NA, 6), zoo::rollmean (plymouthcity_incidence, k = 7, align = "right")),
plymouthtownship_7day = c(rep(NA, 6),zoo::rollmean (plymouthtownship_incidence, k = 7, align = "right")),
combined_7day = c(rep(NA, 6),zoo::rollmean (combined_incidence, k = 7, align = "right")),
canton_15day = c(rep(NA, 14),zoo::rollmean (canton_incidence, k = 15, align = "right")),
plymouthcity_15day =c(rep(NA, 14), zoo::rollmean (plymouthcity_incidence, k = 15, align = "right")),
plymouthtownship_15day = c(rep(NA, 14),zoo::rollmean (plymouthtownship_incidence, k = 15, align = "right")),
combined_15day = c(rep(NA, 14),zoo::rollmean (combined_incidence, k = 15, align = "right")),
canton_28day = c(rep(NA, 27),zoo::rollmean (canton_incidence, k = 28, align = "right")),
plymouthcity_28day =c(rep(NA, 27), zoo::rollmean (plymouthcity_incidence, k = 28, align = "right")),
plymouthtownship_28day = c(rep(NA, 27),zoo::rollmean (plymouthtownship_incidence, k = 28, align = "right")),
combined_28day = c(rep(NA, 27),zoo::rollmean (combined_incidence, k = 28, align = "right")),
) %>%
pivot_longer(cols = -date,
names_to = c("municipality","measure"),
names_sep = "_",
values_to = "value") %>%
mutate (municipality = case_when (
municipality ==  "canton" ~ "Canton",
municipality =="plymouthcity" ~ "Plymouth City",
municipality =="plymouthtownship" ~ "Plymouth Township",
municipality =="combined" ~ "Combined (Canton and Plymouth)")) %>%
mutate (municipality = factor (municipality, levels = c ("Canton", "Plymouth City", "Plymouth Township", "Combined (Canton and Plymouth)")),
value = round (value, 1))
dat$color = as.character (recode (dat$municipality,
'Canton' = "#E90003",
'Plymouth City' = "#1B9E77",
'Plymouth Township' = "#7570B3",
'Combined (Canton and Plymouth)' = "#AAAAAA"))
dat$linetype = as.character (recode (dat$municipality,
'Canton' = 'dash',
'Plymouth City' = 'dot',
'Plymouth Township' = 'dotdash',
'Combined (Canton and Plymouth)' = 'solid'))
return (dat)
}
denoms = readr::read_csv ("denominators.csv",
col_names = c("municipality", "population"),
col_types = "cd")
dat_cases_only = readr::read_csv("covid_cases_20201108.csv",
col_names = c("date",
"canton_cases",
"plymouthcity_cases",
"plymouthtownship_cases"),
col_types = "cddd",
skip=1,
na = ".",
skip_empty_rows = T)
dat_cases_only
recalculate_incidences <- function (dat) {
dat = dat %>%
mutate (date = as.Date(date, format = c("%Y-%m-%d"),
tryFormats = c("%d-%b")),
combined_cases = canton_cases+ plymouthcity_cases + plymouthtownship_cases,
canton_incidence = (canton_cases/as.numeric(denoms[1,2]) * 1000000),
plymouthcity_incidence = (plymouthcity_cases/as.numeric(denoms[2,2]) * 1000000),
plymouthtownship_incidence = (plymouthtownship_cases/as.numeric(denoms[3,2]) * 1000000),
combined_incidence = (combined_cases/as.numeric(denoms[4,2]) * 1000000),
canton_7day = c(rep(NA, 6),zoo::rollmean (canton_incidence, k = 7, align = "right")),
plymouthcity_7day =c(rep(NA, 6), zoo::rollmean (plymouthcity_incidence, k = 7, align = "right")),
plymouthtownship_7day = c(rep(NA, 6),zoo::rollmean (plymouthtownship_incidence, k = 7, align = "right")),
combined_7day = c(rep(NA, 6),zoo::rollmean (combined_incidence, k = 7, align = "right")),
canton_15day = c(rep(NA, 14),zoo::rollmean (canton_incidence, k = 15, align = "right")),
plymouthcity_15day =c(rep(NA, 14), zoo::rollmean (plymouthcity_incidence, k = 15, align = "right")),
plymouthtownship_15day = c(rep(NA, 14),zoo::rollmean (plymouthtownship_incidence, k = 15, align = "right")),
combined_15day = c(rep(NA, 14),zoo::rollmean (combined_incidence, k = 15, align = "right")),
canton_28day = c(rep(NA, 27),zoo::rollmean (canton_incidence, k = 28, align = "right")),
plymouthcity_28day =c(rep(NA, 27), zoo::rollmean (plymouthcity_incidence, k = 28, align = "right")),
plymouthtownship_28day = c(rep(NA, 27),zoo::rollmean (plymouthtownship_incidence, k = 28, align = "right")),
combined_28day = c(rep(NA, 27),zoo::rollmean (combined_incidence, k = 28, align = "right")),
) %>%
pivot_longer(cols = -date,
names_to = c("municipality","measure"),
names_sep = "_",
values_to = "value") %>%
mutate (municipality = case_when (
municipality ==  "canton" ~ "Canton",
municipality =="plymouthcity" ~ "Plymouth City",
municipality =="plymouthtownship" ~ "Plymouth Township",
municipality =="combined" ~ "Combined (Canton and Plymouth)")) %>%
mutate (municipality = factor (municipality, levels = c ("Canton", "Plymouth City", "Plymouth Township", "Combined (Canton and Plymouth)")),
value = round (value, 1))
dat$color = as.character (recode (dat$municipality,
'Canton' = "#E90003",
'Plymouth City' = "#1B9E77",
'Plymouth Township' = "#7570B3",
'Combined (Canton and Plymouth)' = "#AAAAAA"))
dat$linetype = as.character (recode (dat$municipality,
'Canton' = 'dash',
'Plymouth City' = 'dot',
'Plymouth Township' = 'dotdash',
'Combined (Canton and Plymouth)' = 'solid'))
return (dat)
}
dat_all = recalculate_incidences (dat_cases_only)
dat_all
recalculate_incidences <- function (dat) {
dat = dat %>%
mutate (date = as.Date(date, format = c("%Y-%m-%d")),
combined_cases = canton_cases+ plymouthcity_cases + plymouthtownship_cases,
canton_incidence = (canton_cases/as.numeric(denoms[1,2]) * 1000000),
plymouthcity_incidence = (plymouthcity_cases/as.numeric(denoms[2,2]) * 1000000),
plymouthtownship_incidence = (plymouthtownship_cases/as.numeric(denoms[3,2]) * 1000000),
combined_incidence = (combined_cases/as.numeric(denoms[4,2]) * 1000000),
canton_7day = c(rep(NA, 6),zoo::rollmean (canton_incidence, k = 7, align = "right")),
plymouthcity_7day =c(rep(NA, 6), zoo::rollmean (plymouthcity_incidence, k = 7, align = "right")),
plymouthtownship_7day = c(rep(NA, 6),zoo::rollmean (plymouthtownship_incidence, k = 7, align = "right")),
combined_7day = c(rep(NA, 6),zoo::rollmean (combined_incidence, k = 7, align = "right")),
canton_15day = c(rep(NA, 14),zoo::rollmean (canton_incidence, k = 15, align = "right")),
plymouthcity_15day =c(rep(NA, 14), zoo::rollmean (plymouthcity_incidence, k = 15, align = "right")),
plymouthtownship_15day = c(rep(NA, 14),zoo::rollmean (plymouthtownship_incidence, k = 15, align = "right")),
combined_15day = c(rep(NA, 14),zoo::rollmean (combined_incidence, k = 15, align = "right")),
canton_28day = c(rep(NA, 27),zoo::rollmean (canton_incidence, k = 28, align = "right")),
plymouthcity_28day =c(rep(NA, 27), zoo::rollmean (plymouthcity_incidence, k = 28, align = "right")),
plymouthtownship_28day = c(rep(NA, 27),zoo::rollmean (plymouthtownship_incidence, k = 28, align = "right")),
combined_28day = c(rep(NA, 27),zoo::rollmean (combined_incidence, k = 28, align = "right")),
) %>%
pivot_longer(cols = -date,
names_to = c("municipality","measure"),
names_sep = "_",
values_to = "value") %>%
mutate (municipality = case_when (
municipality ==  "canton" ~ "Canton",
municipality =="plymouthcity" ~ "Plymouth City",
municipality =="plymouthtownship" ~ "Plymouth Township",
municipality =="combined" ~ "Combined (Canton and Plymouth)")) %>%
mutate (municipality = factor (municipality, levels = c ("Canton", "Plymouth City", "Plymouth Township", "Combined (Canton and Plymouth)")),
value = round (value, 1))
dat$color = as.character (recode (dat$municipality,
'Canton' = "#E90003",
'Plymouth City' = "#1B9E77",
'Plymouth Township' = "#7570B3",
'Combined (Canton and Plymouth)' = "#AAAAAA"))
dat$linetype = as.character (recode (dat$municipality,
'Canton' = 'dash',
'Plymouth City' = 'dot',
'Plymouth Township' = 'dotdash',
'Combined (Canton and Plymouth)' = 'solid'))
return (dat)
}
denoms = readr::read_csv ("denominators.csv",
col_names = c("municipality", "population"),
col_types = "cd")
dat_cases_only = readr::read_csv("covid_cases_20201108.csv",
col_names = c("date",
"canton_cases",
"plymouthcity_cases",
"plymouthtownship_cases"),
col_types = "cddd",
skip=1,
na = ".",
skip_empty_rows = T)
dat_all = recalculate_incidences (dat_cases_only)
dat_all
dat_selected <- dat_all %>%
filter (date <= max(dat_all$date) & date >= max(dat_all$date) - 28,
measure == "7day")
runApp()
runApp()
runApp()
?saveData
runApp()
runApp()
?tibble
runApp()
runApp()
runApp()
runApp()
?as.Date
